<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.pyl.coby.purchase.service.PurchaseMapper">

	<!-- SQL 적용 해주는 곳 -->

	<!-- 공동구매 글 리스트 보기 -->
	<select id="purchaseSelectList" resultType="PurchaseVO">
		SELECT * FROM
		cb_purchase ORDER BY pr_No DESC
	</select>

	<!-- 공동구매 글 상세 보기 -->
	<select id="purchaseSelect" parameterType="PurchaseVO"
		resultType="PurchaseVO">
		SELECT a.*, b.user_nickname, b.user_profile
		FROM cb_purchase
		a join cb_user b
		ON a.user_id = b.user_id
		WHERE pr_no= #{prNo}
	</select>

	<!-- 공동구매 글 상세보기에서 댓글 불러오기 -->
	<select id="purchaseCmtList" parameterType="PrCmtVO"
		resultType="PrCmtVO">
		select b.*, c.user_nickname, c.user_profile
		from cb_prcmt b
		join cb_user c
		on b.user_id = c.user_id
		where b.pr_no = #{prNo}
		order by
		prcmt_date
	</select>

	<!-- 공동구매글 작성 -->
	<insert id="purchaseInsert" parameterType="PurchaseVO">
		INSERT INTO cb_purchase VALUES (
		pr_seq.nextval, #{prCategory},
		#{prTitle}, #{prMin}, #{prMax}, #{prStartdate},
		#{prEnddate},
		#{prPrice},
		#{prPhoto1}, #{prPhoto2}, #{prPhtro3}, #{prContent}, 1,
		#{userId}
		)
		<selectKey keyProperty="prNo" resultType="int" order="AFTER">
			select
			pr_seq.currval as prNo from dual
		</selectKey>
	</insert>


	<select id="ApplicatePeople" parameterType="PurchaseVO"
		resultType="_int">
		select count(*) AS
		pr_people from cb_applicate
		where
		pr_no=#{prNo}
	</select>

	<!-- 참여 현황 조회(게시글) -->
	<select id="applicateSelect" parameterType="ApplicateVO"
		resultType="ApplicateVO">
		select a.*, b.user_nickname, b.user_profile
		from
		cb_applicate a join cb_user b
		on a.user_id = b.user_id
		where
		pr_no=#{prNo}
	</select>

	<!-- 참여 현황 조회(마이페이지) -->
	<select id="applicateSelectMypage" parameterType="ApplicateVO"
		resultType="ApplicateVO">
		select a.*, b.pr_title
		from cb_applicate a join cb_purchase b
		on a.pr_no = b.pr_no
		where a.user_id=#{userId}
	</select>

	<!-- 참여 현황 추가 -->
	<insert id="applicateInsert" parameterType="ApplicateVO">
		insert into
		cb_applicate values(ap_seq.nextval, #{prNo}, #{userId}, #{apPrice},
		sysdate, #{apPay})
	</insert>
</mapper>